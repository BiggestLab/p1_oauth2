language: erlang
arch:
  - ppc64le
  - amd64

os: linux

dist: xenial

before_install:
  - pip install --user cpp-coveralls coveralls-merge

install:
  - rebar -C rebar.test.config get-deps

script: rebar -C rebar.test.config compile xref && rebar -C rebar.test.config eunit skip_deps=true

otp_release:
  - 17.1
  - 17.5
  - 18.1
  - 22.3
  - 23.0

after_success:
  - cpp-coveralls --exclude lib --exclude tests --gcov-options '\-lp' --dump c.json
  - coveralls-merge c.json erlang.json
